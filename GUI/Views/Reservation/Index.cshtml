<!DOCTYPE html>
<html lang="vi">
@{
        Layout = "_Layout";
}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đặt bàn - Foodie</title>
    <link rel="stylesheet" href="~/css/style.css">
    <!-- Ionicons nếu cần -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</head>
<body class="page-reservation">

    <!-- Header -->
    <div id="header"></div>

    <!-- Nội dung chính -->
    <section class="reservation-wrapper">
        <div class="reservation-card">
            <h2>Đặt bàn tại Foodie</h2>

            <div id="guest-warning" class="alert" style="display:none;">
                Bạn chưa đăng nhập. <a href="login.html">Đăng nhập</a> để đặt bàn nhanh hơn!
            </div>

            <form id="reservationForm">
                <div>
                    <label for="name">Họ và tên *</label>
                    <input type="text" id="name">
                </div>
                <div>
                    <label for="email">Email *</label>
                    <input type="email" id="email">
                </div>
                <div>
                    <label for="phone">Số điện thoại *</label>
                    <input type="tel" id="phone" required pattern="[0-9]{10}">
                </div>
                <div>
                    <label for="guests">Loại bàn *</label>
                    <select id="guests" required>
                        <option value="">-- Chọn loại bàn--</option>
                        <option value="1">Bàn đơn (1-2 người)</option>
                        <option value="2">Bàn đôi (3-4 người)</option>
                        <option value="3">Bàn gia đình (5+ người)</option>
                    </select>
                </div>
                <div>
                    <label for="date">Ngày *</label>
                    <input type="date" id="date" required>
                </div>
                <div>
                    <label for="time">Giờ *</label>
                    <input type="time" id="time" required>
                </div>
                <div>
                    <label for="message">Ghi chú (tuỳ chọn)</label>
                    <textarea id="message" rows="3" placeholder="Ví dụ: vị trí ngồi bạn muốn.."></textarea>
                </div>

                <button type="submit">Đặt bàn ngay</button>
            </form>

            <p class="reservation-footer-text">
                Muốn thay đổi thông tin tài khoản? <a href="profile.html">Cập nhật tại đây</a>
            </p>
        </div>
    </section>

    <!-- Footer -->
    <div id="footer"></div>

    <!-- Script load header/footer & xử lý form -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {

          // ===== Load header/footer =====
          async function loadHTML(id, url) {
            try {
              const res = await fetch(url);
              if (!res.ok) throw new Error("HTTP error " + res.status);
              const html = await res.text();
              document.getElementById(id).innerHTML = html;
            } catch (err) {
              console.error("Load " + id + " failed:", err);
            }
          }
          loadHTML("header", "partials/header.html");
          loadHTML("footer", "partials/footer.html");

          // const userLogin = null; // bật dòng này để test chưa đăng nhập

          const guestWarning = document.getElementById("guest-warning");
          const nameInput = document.getElementById("name");
          const emailInput = document.getElementById("email");
          const phoneInput = document.getElementById("phone");

          if (userLogin) {
            guestWarning.style.display = "none";
            nameInput.value = userLogin.name;
            emailInput.value = userLogin.email;
            phoneInput.value = userLogin.phone;

            nameInput.readOnly = true;
            emailInput.readOnly = true;
            phoneInput.readOnly = true;

            nameInput.style.background = "#f9f9f9";
            emailInput.style.background = "#f9f9f9";
            phoneInput.style.background = "#f9f9f9";
          } else {
            guestWarning.style.display = "block";
          }

          // ===== Xử lý submit =====
          document.getElementById("reservationForm").addEventListener("submit", (e) => {
            e.preventDefault();
            const phone = phoneInput.value.trim();
            if (!/^[0-9]{10}$/.test(phone)) {
              alert("❌ Số điện thoại phải có đúng 10 chữ số!");
              return;
            }
            alert("✅ Đặt bàn thành công! Cảm ơn bạn đã chọn Foodie.");
          });

        });
    </script>
</body>
</html>
